diff -up bind-9.8.2rc1/bin/named/query.c.CVE-2012-5689 bind-9.8.2rc1/bin/named/query.c
--- bind-9.8.2rc1/bin/named/query.c.CVE-2012-5689	2013-02-01 14:39:30.238929516 +0100
+++ bind-9.8.2rc1/bin/named/query.c	2013-02-01 14:56:34.716253302 +0100
@@ -5698,6 +5698,7 @@ query_find(ns_client_t *client, dns_fetc
 			 */
 			client->attributes &= ~NS_CLIENTATTR_WANTDNSSEC;
 			query_putrdataset(client, &sigrdataset);
+			rpz_st->q.is_zone = is_zone;
 			is_zone = ISC_TRUE;
 			rpz_log_rewrite(client, "", rpz_st->m.policy,
 					rpz_st->m.type, rpz_st->qname);
@@ -6075,6 +6076,15 @@ query_find(ns_client_t *client, dns_fetc
 			rdataset = NULL;
 			sigrdataset = NULL;
 			type = qtype = dns_rdatatype_a;
+			rpz_st = client->query.rpz_st;
+			if (rpz_st != NULL) {
+				/*
+				 * Arrange for RPZ rewriting of any A records.
+				 */
+				if ((rpz_st->state & DNS_RPZ_REWRITTEN) != 0)
+					is_zone = rpz_st->q.is_zone;
+				rpz_st_clear(client);
+			}
 			dns64 = ISC_TRUE;
 			goto db_find;
 		}
@@ -6333,6 +6343,15 @@ query_find(ns_client_t *client, dns_fetc
 			sigrdataset = NULL;
 			fname = NULL;
 			type = qtype = dns_rdatatype_a;
+			rpz_st = client->query.rpz_st;
+			if (rpz_st != NULL) {
+				/*
+				 * Arrange for RPZ rewriting of any A records.
+				 */
+				if ((rpz_st->state & DNS_RPZ_REWRITTEN) != 0)
+					is_zone = rpz_st->q.is_zone;
+				rpz_st_clear(client);
+			}
 			dns64 = ISC_TRUE;
 			goto db_find;
 		}
@@ -6827,6 +6846,15 @@ query_find(ns_client_t *client, dns_fetc
 			rdataset = NULL;
 			sigrdataset = NULL;
 			type = qtype = dns_rdatatype_a;
+			rpz_st = client->query.rpz_st;
+			if (rpz_st != NULL) {
+				/*
+				 * Arrange for RPZ rewriting of any A records.
+				 */
+				if ((rpz_st->state & DNS_RPZ_REWRITTEN) != 0)
+					is_zone = rpz_st->q.is_zone;
+				rpz_st_clear(client);
+			}
 			dns64_exclude = dns64 = ISC_TRUE;
 			goto db_find;
 		}
